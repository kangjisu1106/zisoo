<!DOCTYPE html>
<html lang=ko>
<head>
<meta charset=UTF-8>
<meta name=viewport content="width=device-width, initial-scale=1.0">
<title>3D 물방울 애니메이션</title>
<script src=https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js></script>
<style>body{margin:0;padding:0;overflow:hidden;font-family:'Pretendard',sans-serif;background:#000;cursor:none}canvas{display:block}.overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:white;z-index:10;pointer-events:none;transition:opacity 2s ease-in-out}h1{font-size:3em;margin-bottom:20px}p{font-size:1.2em;max-width:600px;margin:0 auto;margin-bottom:10px}.instruction{font-size:1em;color:#09f;font-weight:800;animation:pulse 2s infinite}@keyframes pulse{0%{opacity:.6}50%{opacity:1}100%{opacity:.6}}.custom-cursor{position:absolute;width:30px;height:30px;border-radius:50px;transform:translate(-50%,-50%);pointer-events:none;z-index:9999;transition:transform .1s,background .3s}.controls-info{position:absolute;bottom:20px;left:20px;color:rgba(255,255,255,0.7);padding:10px 15px;border-radius:8px;font-size:.9em;transition:opacity .5s;max-width:400px;z-index:100}.controls-info h3{margin-top:0;margin-bottom:10px;font-size:1.1em;color:#09f}.controls-info ul{list-style-type:none;padding-left:0;margin:0}.controls-info li{margin-bottom:8px;display:flex;align-items:center}.key{display:inline-block;padding:2px 6px;margin-right:8px;font-family:monospace;min-width:16px;text-align:center}.mode-indicator{position:absolute;top:20px;right:20px;background:rgba(0,0,0,0.5);color:white;padding:6px 12px;border-radius:4px;font-size:.9em;transition:opacity .3s;z-index:100}.mode-indicator.time-warp{background:rgba(255,0,255,0.5);color:#fff;font-weight:bold}#home-button{position:fixed;left:20px;top:20px;z-index:100;width:50px;height:50px;background:linear-gradient(135deg,rgba(255,255,255,0.1) 0,rgba(255,255,255,0.2) 100%);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.15);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .3s ease;box-shadow:0 8px 32px rgba(0,0,0,0.3)}#home-button:hover{background:linear-gradient(135deg,rgba(255,255,255,0.2) 0,rgba(255,255,255,0.3) 100%);transform:translateY(-2px) scale(1.05);box-shadow:0 12px 40px rgba(0,0,0,0.4)}#home-button svg{width:24px;height:24px;fill:rgba(255,255,255,0.8);transition:all .3s ease}#home-button:hover svg{fill:rgba(255,255,255,1)}</style>
</head>
<body>
<div id=home-button onclick=goHome()>
<svg viewBox="0 0 24 24">
<path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
</svg>
</div>
<div class=overlay>
<h1>BUBBLE BUBBLE</h1>
<p>현실처럼 생생한 물방울이 부드럽게 떨어지는 순간을 느껴보세요.</p>
<p class=instruction>마우스를 움직여 물방울을 흩트리고, 클릭하여 물방울을 생성하세요!</p>
<p>키보드 <span class=key>H</span>를 눌러 단축키 도움말을 확인하세요.</p>
</div>
<div class=custom-cursor></div>
<div class=controls-info style=opacity:0>
<h3>키보드 단축키</h3>
<ul>
<li><span class=key>H</span> 도움말 표시/숨기기</li>
<li><span class=key>R</span> 모든 물방울 재설정</li>
<li><span class=key>S</span> 물방울 속도 변경</li>
<li><span class=key>C</span> 색상 모드 변경</li>
<li><span class=key>G</span> 중력 효과 조절</li>
<li><span class=key>B</span> 배경색 변경</li>
<li><span class=key>+</span> 물방울 추가</li>
<li><span class=key>-</span> 물방울 감소</li>
<li><span class=key>W</span> 물결 효과 조절</li>
<li><span class=key>F</span> 물방울 효과 전환</li>
<li><span class=key>T</span> 태풍 모드</li>
<li><span class=key>Q</span> 시간 왜곡 모드 (슬로우/타임랩스)</li>
<li><span class=key>Space</span> 일시정지/재생</li>
<li><span class=key>P</span> 사진 모드 (카메라 이동 정지)</li>
<li><span class=key>Esc</span> 오버레이 숨기기/표시</li>
</ul>
</div>
<div class=mode-indicator style=opacity:0>기본 모드</div>
<script>function goHome(){window.location.href='index.html';}
const scene=new THREE.Scene();const camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,1000);const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});renderer.setSize(window.innerWidth,window.innerHeight);renderer.setClearColor(0x000000);renderer.shadowMap.enabled=true;renderer.shadowMap.type=THREE.PCFSoftShadowMap;document.body.appendChild(renderer.domElement);const settings={paused:false,cameraMovement:true,gravityStrength:0.001,speedMultiplier:1.0,colorMode:"rainbow",dropEffectType:"normal",dropCount:80,maxDrops:200,minDrops:10,bgColors:[0x000000,0x87CEEB,0x000033,0x003366,0x2c3e50],currentBgIndex:0,waveIntensity:1.0,tornadoMode:false,helpVisible:false,overlayVisible:true,timeWarpMode:false,timeWarpFactor:1.0,twistIntensity:0.0};function updateModeIndicator(text){const indicator=document.querySelector('.mode-indicator');indicator.textContent=text;indicator.style.opacity=1;if(settings.timeWarpMode){indicator.classList.add('time-warp');}else{indicator.classList.remove('time-warp');}
setTimeout(()=>{indicator.style.opacity=0;},2000);}
const ambientLight=new THREE.AmbientLight(0x404080,0.4);scene.add(ambientLight);const mainLight=new THREE.DirectionalLight(0xffffff,1.5);mainLight.position.set(15,30,15);mainLight.castShadow=true;mainLight.shadow.mapSize.width=2048;mainLight.shadow.mapSize.height=2048;mainLight.shadow.camera.near=0.5;mainLight.shadow.camera.far=100;mainLight.shadow.camera.left=-30;mainLight.shadow.camera.right=30;mainLight.shadow.camera.top=30;mainLight.shadow.camera.bottom=-30;scene.add(mainLight);const fillLight=new THREE.DirectionalLight(0x4488ff,0.5);fillLight.position.set(-10,15,-10);scene.add(fillLight);const cubeRenderTarget=new THREE.WebGLCubeRenderTarget(128,{format:THREE.RGBFormat,generateMipmaps:true,minFilter:THREE.LinearMipmapLinearFilter});const cubeCamera=new THREE.CubeCamera(0.1,1000,cubeRenderTarget);scene.add(cubeCamera);const planeGeometry=new THREE.PlaneGeometry(100,100,50,50);const planeMaterial=new THREE.MeshPhysicalMaterial({color:0x0077be,transparent:true,opacity:0.85,metalness:0.05,roughness:0.05,transmission:0.95,reflectivity:1,clearcoat:1.0,clearcoatRoughness:0.2,side:THREE.DoubleSide});const plane=new THREE.Mesh(planeGeometry,planeMaterial);plane.rotation.x=-Math.PI/2;plane.position.y=-20;plane.receiveShadow=true;scene.add(plane);function updateWaterSurface(time){if(settings.paused)return;const vertices=plane.geometry.attributes.position.array;for(let i=0;i<vertices.length;i+=3){const x=vertices[i];const z=vertices[i+2];vertices[i+1]=Math.sin(x*0.05+time*0.7)*0.3*settings.waveIntensity+
Math.sin(z*0.1+time*0.5)*0.2*settings.waveIntensity+
Math.sin((x*z)*0.01+time*0.3)*0.1*settings.waveIntensity;}
plane.geometry.attributes.position.needsUpdate=true;plane.geometry.computeVertexNormals();}
function getRainbowColor(phase){const r=Math.sin(phase+0)*0.3+0.7;const g=Math.sin(phase+2)*0.3+0.7;const b=Math.sin(phase+4)*0.3+0.7;return new THREE.Color(r,g,b);}
function getColorByMode(phase){switch(settings.colorMode){case"rainbow":return getRainbowColor(phase);case"blue":const blueIntensity=0.5+Math.sin(phase)*0.2;return new THREE.Color(0.3,0.5,0.8+blueIntensity);case"random":if(Math.random()<0.05){return new THREE.Color(Math.random()*0.5+0.5,Math.random()*0.5+0.5,Math.random()*0.5+0.5);}
return null;case"monochrome":const gray=0.7+Math.sin(phase)*0.3;return new THREE.Color(gray,gray,gray);default:return getRainbowColor(phase);}}
camera.position.z=40;camera.position.y=15;camera.lookAt(0,0,0);class Raindrop{constructor(){this.createGeometry();this.createMaterial();this.setupPhysics();this.setupVisuals();scene.add(this.drop);}
createGeometry(){switch(settings.dropEffectType){case"bubble":this.geometry=new THREE.SphereGeometry(1,32,32);break;case"glitter":this.geometry=new THREE.IcosahedronGeometry(1,1);break;case"jelly":this.geometry=new THREE.SphereGeometry(1,16,16);const vertices=this.geometry.attributes.position.array;for(let i=0;i<vertices.length;i+=3){const noise=(Math.random()-0.5)*0.2;vertices[i]*=(1+noise);vertices[i+1]*=(1+noise);vertices[i+2]*=(1+noise);}
this.geometry.computeVertexNormals();break;default:this.geometry=new THREE.SphereGeometry(1,32,32);const verts=this.geometry.attributes.position.array;for(let i=0;i<verts.length;i+=3){const y=verts[i+1];if(y<0){verts[i+1]=y*(1-y*y*0.15);}}
this.geometry.computeVertexNormals();break;}}
createMaterial(){switch(settings.dropEffectType){case"bubble":this.material=new THREE.MeshPhysicalMaterial({color:0xffffff,transparent:true,opacity:0.6,roughness:0.1,metalness:0,transmission:0.99,ior:1.1,clearcoat:1.0,clearcoatRoughness:0.1,envMap:cubeRenderTarget.texture,side:THREE.DoubleSide});break;case"glitter":this.material=new THREE.MeshPhysicalMaterial({color:0xffffff,transparent:true,opacity:0.8,roughness:0.1,metalness:0.8,reflectivity:1.0,clearcoat:1.0,clearcoatRoughness:0.1,envMap:cubeRenderTarget.texture,side:THREE.DoubleSide});break;case"jelly":this.material=new THREE.MeshPhysicalMaterial({color:0xffffff,transparent:true,opacity:0.9,roughness:0.2,metalness:0,transmission:0.9,ior:1.5,clearcoat:0.5,clearcoatRoughness:0.3,envMap:cubeRenderTarget.texture,side:THREE.DoubleSide});break;default:this.material=new THREE.MeshPhysicalMaterial({color:0xffffff,transparent:true,opacity:0.8,roughness:0.03,metalness:0,transmission:0.98,ior:1.333,clearcoat:1.0,clearcoatRoughness:0.01,envMap:cubeRenderTarget.texture,side:THREE.DoubleSide});break;}}
setupPhysics(){this.drop=new THREE.Mesh(this.geometry,this.material);const scale=Math.random()*Math.random()*1.2+0.4;this.drop.scale.set(scale,scale*(1+Math.random()*0.3),scale);this.reset();this.velocity={x:(Math.random()-0.5)*0.05,y:Math.random()*0.05+0.15,z:(Math.random()-0.5)*0.05};this.acceleration=settings.gravityStrength;this.rotationSpeed={x:(Math.random()-0.5)*0.02,y:(Math.random()-0.5)*0.02,z:(Math.random()-0.5)*0.02};this.turbulence=0.0003;this.drop.castShadow=true;}
setupVisuals(){this.glitterPhase=Math.random()*Math.PI*2;this.glitterSpeed=Math.random()*0.1+0.05;}
update(time){if(settings.paused)return;this.velocity.y+=this.acceleration;if(settings.tornadoMode){const distanceFromCenter=Math.sqrt(this.drop.position.x*this.drop.position.x+
this.drop.position.z*this.drop.position.z);const rotationSpeed=0.05-Math.min(0.05,distanceFromCenter*0.001);let angle=Math.atan2(this.drop.position.z,this.drop.position.x);angle+=rotationSpeed;const pullFactor=0.01;const newRadius=distanceFromCenter*(1-pullFactor);const newX=Math.cos(angle)*newRadius;const newZ=Math.sin(angle)*newRadius;this.velocity.x=(newX-this.drop.position.x)*0.1;this.velocity.z=(newZ-this.drop.position.z)*0.1;const heightEffect=Math.max(0,20-this.drop.position.y)*0.002;this.velocity.y-=heightEffect;}else{this.velocity.x+=(Math.random()-0.5)*this.turbulence;this.velocity.z+=(Math.random()-0.5)*this.turbulence;}
const timeScale=settings.timeWarpFactor;this.velocity.x*=timeScale;this.velocity.y*=timeScale;this.velocity.z*=timeScale;const maxSpeed=0.4*settings.speedMultiplier*timeScale;const currentSpeed=Math.sqrt(this.velocity.x*this.velocity.x+
this.velocity.y*this.velocity.y+
this.velocity.z*this.velocity.z);if(currentSpeed>maxSpeed){this.velocity.x=(this.velocity.x/currentSpeed)*maxSpeed;this.velocity.y=(this.velocity.y/currentSpeed)*maxSpeed;this.velocity.z=(this.velocity.z/currentSpeed)*maxSpeed;}
this.drop.position.x+=this.velocity.x*settings.speedMultiplier;this.drop.position.y-=this.velocity.y*settings.speedMultiplier;this.drop.position.z+=this.velocity.z*settings.speedMultiplier;this.drop.rotation.x+=this.rotationSpeed.x*timeScale;this.drop.rotation.y+=this.rotationSpeed.y*timeScale;this.drop.rotation.z+=this.rotationSpeed.z*timeScale;if(settings.timeWarpMode){const twistFactor=Math.sin(time+this.drop.position.y*0.1)*settings.twistIntensity;this.drop.rotation.y+=twistFactor;this.drop.scale.x=this.drop.scale.x*(1+twistFactor*0.1);this.drop.scale.z=this.drop.scale.z*(1-twistFactor*0.1);}
this.drop.rotation.x=this.velocity.z*2;this.drop.rotation.z=-this.velocity.x*2;if(settings.dropEffectType!=="glitter"){const stretchFactor=Math.min(this.velocity.y*3,0.5);this.drop.scale.y=this.drop.scale.x*(1+stretchFactor);}
this.glitterPhase+=this.glitterSpeed;const newColor=getColorByMode(this.glitterPhase);if(newColor){this.drop.material.color.lerp(newColor,0.05);}
if(this.drop.position.y<-18.5){this.createSplash();this.reset();}
if(Math.abs(this.drop.position.x)>50||this.drop.position.y>60||Math.abs(this.drop.position.z)>50){this.reset();}}
createSplash(){const impact=Math.min(this.velocity.y*15,1.5);const splashCount=Math.floor(10*impact);const splashSize=this.drop.scale.x*0.3;const impactPos={x:this.drop.position.x,y:-19.5+(Math.random()*0.5),z:this.drop.position.z};createRipple(impactPos,impact);for(let i=0;i<splashCount;i++){const splashGeometry=new THREE.SphereGeometry(splashSize,8,8);const splashMaterial=new THREE.MeshPhysicalMaterial({color:0xd4f1f9,transparent:true,opacity:0.7,roughness:0.1,transmission:0.95,ior:1.333,clearcoat:0.8});const splash=new THREE.Mesh(splashGeometry,splashMaterial);splash.position.set(impactPos.x,impactPos.y,impactPos.z);const angle=(i/splashCount)*Math.PI*2;const elevationAngle=Math.random()*Math.PI*0.4;const speed=Math.random()*0.3*impact+0.1;splash.userData={velocity:{x:Math.cos(angle)*Math.cos(elevationAngle)*speed,y:Math.sin(elevationAngle)*speed,z:Math.sin(angle)*Math.cos(elevationAngle)*speed},lifespan:0,maxLife:60+Math.random()*30,gravity:0.006,originalSize:splashSize,phase:Math.random()*Math.PI*2};splash.castShadow=true;scene.add(splash);splashes.push(splash);}}
reset(){this.drop.position.x=Math.random()*60-30;this.drop.position.y=Math.random()*10+40;this.drop.position.z=Math.random()*60-30;this.velocity={x:(Math.random()-0.5)*0.05,y:Math.random()*0.05+0.05,z:(Math.random()-0.5)*0.05};this.acceleration=settings.gravityStrength;}}
const splashes=[];const clickDrops=[];const ripples=[];function updateSplashes(time){if(settings.paused)return;for(let i=splashes.length-1;i>=0;i--){const splash=splashes[i];const data=splash.userData;splash.position.x+=data.velocity.x*settings.speedMultiplier;splash.position.y+=data.velocity.y*settings.speedMultiplier;splash.position.z+=data.velocity.z*settings.speedMultiplier;data.velocity.y-=data.gravity*settings.gravityStrength*2;data.velocity.x*=0.98;data.velocity.z*=0.98;splash.rotation.x+=0.05;splash.rotation.y+=0.03;data.lifespan+=1;if(data.lifespan>data.maxLife*0.7){const shrinkFactor=1-((data.lifespan-data.maxLife*0.7)/(data.maxLife*0.3));splash.scale.set(shrinkFactor,shrinkFactor,shrinkFactor);splash.material.opacity=shrinkFactor*0.7;}
if(data.lifespan%5===0){data.phase+=0.1;const newColor=getColorByMode(data.phase);if(newColor)splash.material.color.lerp(newColor,0.1);}
if(data.lifespan>data.maxLife||splash.position.y<-19.5){if(splash.position.y<-19.5){createRipple({x:splash.position.x,y:-19.5,z:splash.position.z},0.2);}
scene.remove(splash);splashes.splice(i,1);}}}
function createRipple(position,strength){if(settings.paused)return;const rippleGeometry=new THREE.CircleGeometry(0.5,16);const rippleMaterial=new THREE.MeshBasicMaterial({color:0xadd8e6,transparent:true,opacity:0.7,side:THREE.DoubleSide});const ripple=new THREE.Mesh(rippleGeometry,rippleMaterial);ripple.rotation.x=-Math.PI/2;ripple.position.set(position.x,-19.4,position.z);ripple.userData={age:0,maxAge:40+Math.random()*20,expandSpeed:0.2+strength*0.3*settings.waveIntensity};scene.add(ripple);ripples.push(ripple);}
function updateRipples(){if(settings.paused)return;for(let i=ripples.length-1;i>=0;i--){const ripple=ripples[i];const data=ripple.userData;ripple.scale.x+=data.expandSpeed;ripple.scale.z+=data.expandSpeed;data.expandSpeed*=0.95;ripple.material.opacity=0.7*(1-(data.age/data.maxAge));data.age+=1;if(data.age>=data.maxAge){scene.remove(ripple);ripples.splice(i,1);}}}
const raindrops=[];function initRaindrops(){for(let i=raindrops.length-1;i>=0;i--){scene.remove(raindrops[i].drop);raindrops.splice(i,1);}
for(let i=0;i<settings.dropCount;i++){raindrops.push(new Raindrop());}}
initRaindrops();const fogColor=new THREE.Color(0x000033);scene.fog=new THREE.FogExp2(fogColor,0.01);function changeBackgroundColor(){settings.currentBgIndex=(settings.currentBgIndex+1)%settings.bgColors.length;const newColor=settings.bgColors[settings.currentBgIndex];renderer.setClearColor(newColor);if(newColor===0x000000){scene.fog.color.set(new THREE.Color(newColor).lerp(new THREE.Color(0xffffff),0.3));}
updateModeIndicator(`배경색 변경:${newColor.toString(16)}`);}
function updateClickDrops(){if(settings.paused)return;for(let i=clickDrops.length-1;i>=0;i--){const drop=clickDrops[i];const data=drop.userData;data.velocity.y+=data.acceleration*settings.gravityStrength;data.velocity.x+=(Math.random()-0.5)*data.turbulence;data.velocity.z+=(Math.random()-0.5)*data.turbulence;drop.position.x+=data.velocity.x*settings.speedMultiplier;drop.position.y-=data.velocity.y*settings.speedMultiplier;drop.position.z+=data.velocity.z*settings.speedMultiplier;drop.rotation.x+=data.rotationSpeed.x;drop.rotation.y+=data.rotationSpeed.y;drop.rotation.z+=data.rotationSpeed.z;drop.rotation.x=data.velocity.z*2;drop.rotation.z=-data.velocity.x*2;data.glitterPhase+=data.glitterSpeed;const newColor=getColorByMode(data.glitterPhase);if(newColor){drop.material.color.lerp(newColor,0.05);}
data.lifespan++;if(data.lifespan>data.maxLife*0.7){const fadeRatio=1-((data.lifespan-data.maxLife*0.7)/(data.maxLife*0.3));drop.material.opacity=fadeRatio*0.8;drop.scale.multiplyScalar(0.995);}
if(drop.position.y<-18.5){const impact=Math.min(data.velocity.y*15,1.5);const splashCount=Math.floor(5*impact);const splashSize=drop.scale.x*0.3;const impactPos={x:drop.position.x,y:-19.5+(Math.random()*0.5),z:drop.position.z};createRipple(impactPos,impact);for(let j=0;j<splashCount;j++){const splashGeometry=new THREE.SphereGeometry(splashSize,8,8);const splashMaterial=new THREE.MeshPhysicalMaterial({color:drop.material.color,transparent:true,opacity:0.7,roughness:0.1,transmission:0.95,ior:1.333,clearcoat:0.8});const splash=new THREE.Mesh(splashGeometry,splashMaterial);splash.position.set(impactPos.x,impactPos.y,impactPos.z);const angle=(j/splashCount)*Math.PI*2;const elevationAngle=Math.random()*Math.PI*0.4;const speed=Math.random()*0.3*impact+0.1;splash.userData={velocity:{x:Math.cos(angle)*Math.cos(elevationAngle)*speed,y:Math.sin(elevationAngle)*speed,z:Math.sin(angle)*Math.cos(elevationAngle)*speed},lifespan:0,maxLife:60+Math.random()*30,gravity:0.006,originalSize:splashSize,phase:data.glitterPhase};splash.castShadow=true;scene.add(splash);splashes.push(splash);}
scene.remove(drop);clickDrops.splice(i,1);}else if(data.lifespan>=data.maxLife||drop.position.y>60){scene.remove(drop);clickDrops.splice(i,1);}}}
let time=0;function animate(){requestAnimationFrame(animate);if(!settings.paused){time+=0.01*settings.timeWarpFactor;}
if(Math.floor(time*10)%10===0&&!settings.paused){cubeCamera.update(renderer,scene);}
updateWaterSurface(time);raindrops.forEach(raindrop=>raindrop.update(time));updateSplashes(time);updateRipples();updateClickDrops();if(settings.cameraMovement){const cameraX=Math.sin(time*0.1)*3;const cameraZ=Math.cos(time*0.05)*3;camera.position.x=cameraX;camera.position.z=40+cameraZ;}
camera.lookAt(0,0,0);renderer.render(scene,camera);}
animate();const mouse=new THREE.Vector2();const raycaster=new THREE.Raycaster();let mousePressed=false;let hideTimeout;const customCursor=document.querySelector('.custom-cursor');function onMouseMove(event){mouse.x=(event.clientX/window.innerWidth)*2-1;mouse.y=-(event.clientY/window.innerHeight)*2+1;customCursor.style.left=event.clientX+'px';customCursor.style.top=event.clientY+'px';if(settings.overlayVisible){document.querySelector('.overlay').style.opacity='1';clearTimeout(hideTimeout);hideTimeout=setTimeout(()=>{document.querySelector('.overlay').style.opacity='0';},4000);}
raycaster.setFromCamera(mouse,camera);interactWithDrops(event.clientX,event.clientY);}
function interactWithDrops(mouseX,mouseY){if(settings.paused)return;const vector=new THREE.Vector3(mouse.x,mouse.y,0.5);vector.unproject(camera);const dir=vector.sub(camera.position).normalize();const distance=-camera.position.z/dir.z;const pos=camera.position.clone().add(dir.multiplyScalar(distance));raindrops.forEach(raindrop=>{const dropPos=raindrop.drop.position;const dx=dropPos.x-pos.x;const dy=dropPos.y-pos.y;const dz=dropPos.z-camera.position.z*0.2;const distance=Math.sqrt(dx*dx+dy*dy+dz*dz);const influenceRadius=15;if(distance<influenceRadius){const power=1-(distance/influenceRadius);const angle=Math.atan2(dy,dx);const force=0.05*power;raindrop.velocity.x+=Math.cos(angle)*force;raindrop.velocity.z+=Math.sin(angle)*force;raindrop.drop.material.color.lerp(new THREE.Color(0x72b9ff),0.1);raindrop.drop.scale.multiplyScalar(1+power*0.05);customCursor.style.transform=`translate(-50%,-50%)scale(${1+power*0.5})`;customCursor.style.background=`rgba(114,185,255,${0.3+power*0.4})`;}});}
function createClickDrop(mouseX,mouseY){if(settings.paused)return;const vector=new THREE.Vector3(mouse.x,mouse.y,0.5);vector.unproject(camera);const dir=vector.sub(camera.position).normalize();const distance=-camera.position.y/dir.y;const pos=camera.position.clone().add(dir.multiplyScalar(distance));const dropCount=5+Math.floor(Math.random()*5);for(let i=0;i<dropCount;i++){const theta=Math.random()*Math.PI*2;const phi=Math.acos(2*Math.random()-1);const radius=2+Math.random()*3;const offsetX=radius*Math.sin(phi)*Math.cos(theta);const offsetY=radius*Math.sin(phi)*Math.sin(theta);const offsetZ=radius*Math.cos(phi);let sphereGeometry;switch(settings.dropEffectType){case"bubble":sphereGeometry=new THREE.SphereGeometry(1,32,32);break;case"glitter":sphereGeometry=new THREE.IcosahedronGeometry(1,1);break;case"jelly":sphereGeometry=new THREE.SphereGeometry(1,16,16);const jVertices=sphereGeometry.attributes.position.array;for(let j=0;j<jVertices.length;j+=3){const noise=(Math.random()-0.5)*0.2;jVertices[j]*=(1+noise);jVertices[j+1]*=(1+noise);jVertices[j+2]*=(1+noise);}
sphereGeometry.computeVertexNormals();break;default:sphereGeometry=new THREE.SphereGeometry(1,32,32);const vertices=sphereGeometry.attributes.position.array;for(let j=0;j<vertices.length;j+=3){const y=vertices[j+1];if(y<0){vertices[j+1]=y*(1-y*y*0.15);}}
sphereGeometry.computeVertexNormals();break;}
let material;const colorVal=0.8+Math.random()*0.2;switch(settings.dropEffectType){case"bubble":material=new THREE.MeshPhysicalMaterial({color:new THREE.Color(colorVal,colorVal,colorVal),transparent:true,opacity:0.6,roughness:0.1,metalness:0,transmission:0.99,ior:1.1,clearcoat:1.0,clearcoatRoughness:0.1,envMap:cubeRenderTarget.texture,side:THREE.DoubleSide});break;case"glitter":material=new THREE.MeshPhysicalMaterial({color:new THREE.Color(0.8+Math.random()*0.2,0.8+Math.random()*0.2,0.9+Math.random()*0.1),transparent:true,opacity:0.8,roughness:0.1,metalness:0.8,reflectivity:1.0,clearcoat:1.0,clearcoatRoughness:0.1,envMap:cubeRenderTarget.texture,side:THREE.DoubleSide});break;case"jelly":material=new THREE.MeshPhysicalMaterial({color:new THREE.Color(0.7+Math.random()*0.3,0.7+Math.random()*0.3,0.9+Math.random()*0.1),transparent:true,opacity:0.9,roughness:0.2,metalness:0,transmission:0.9,ior:1.5,clearcoat:0.5,clearcoatRoughness:0.3,envMap:cubeRenderTarget.texture,side:THREE.DoubleSide});break;default:material=new THREE.MeshPhysicalMaterial({color:new THREE.Color(0.8+Math.random()*0.2,0.8+Math.random()*0.2,0.9+Math.random()*0.1),transparent:true,opacity:0.8,roughness:0.03,metalness:0,transmission:0.98,ior:1.333,clearcoat:1.0,clearcoatRoughness:0.01,envMap:cubeRenderTarget.texture,side:THREE.DoubleSide});break;}
const drop=new THREE.Mesh(sphereGeometry,material);const scale=Math.random()*1.5+0.5;drop.scale.set(scale,scale,scale);drop.position.set(pos.x+offsetX,pos.y+offsetY,pos.z+offsetZ);const velocity={x:(Math.random()-0.5)*0.2,y:Math.random()*0.1+0.1,z:(Math.random()-0.5)*0.2};drop.castShadow=true;const userData={velocity:velocity,acceleration:settings.gravityStrength,lifespan:0,maxLife:100+Math.random()*100,rotationSpeed:{x:(Math.random()-0.5)*0.02,y:(Math.random()-0.5)*0.02,z:(Math.random()-0.5)*0.02},turbulence:0.0003,glitterPhase:Math.random()*Math.PI*2,glitterSpeed:Math.random()*0.1+0.05,fromClick:true};drop.userData=userData;scene.add(drop);clickDrops.push(drop);const rippleStrength=0.5+Math.random()*0.5;createRipple({x:pos.x+offsetX*0.5,y:-19.5,z:pos.z+offsetZ*0.5},rippleStrength);}
customCursor.style.transform='translate(-50%, -50%) scale(1.5)';customCursor.style.background='rgba(255, 255, 255, 0.5)';setTimeout(()=>{customCursor.style.transform='translate(-50%, -50%) scale(1)';customCursor.style.background='rgba(255, 255, 255, 0.3)';},300);}
function onMouseDown(event){mousePressed=true;createClickDrop(event.clientX,event.clientY);}
function onMouseUp(){mousePressed=false;}
function onKeyDown(event){switch(event.key){case'h':case'H':settings.helpVisible=!settings.helpVisible;document.querySelector('.controls-info').style.opacity=settings.helpVisible?'1':'0';break;case'r':case'R':raindrops.forEach(raindrop=>raindrop.reset());updateModeIndicator('물방울 재설정');break;case's':case'S':settings.speedMultiplier=((settings.speedMultiplier*10)%30+10)/10;updateModeIndicator(`속도:x${settings.speedMultiplier.toFixed(1)}`);break;case'c':case'C':const colorModes=["rainbow","blue","random","monochrome"];const currentIndex=colorModes.indexOf(settings.colorMode);settings.colorMode=colorModes[(currentIndex+1)%colorModes.length];updateModeIndicator(`색상 모드:${settings.colorMode}`);break;case'g':case'G':settings.gravityStrength=((settings.gravityStrength*1000)%3+1)/1000;raindrops.forEach(raindrop=>raindrop.acceleration=settings.gravityStrength);updateModeIndicator(`중력:x${(settings.gravityStrength*1000).toFixed(1)}`);break;case'b':case'B':changeBackgroundColor();break;case'+':case'=':if(settings.dropCount<settings.maxDrops){settings.dropCount+=10;for(let i=0;i<10;i++){raindrops.push(new Raindrop());}
updateModeIndicator(`물방울:${settings.dropCount}개`);}else{updateModeIndicator(`최대 물방울 개수:${settings.maxDrops}개`);}
break;case'-':case'_':if(settings.dropCount>settings.minDrops){settings.dropCount-=10;for(let i=0;i<10;i++){if(raindrops.length>0){const drop=raindrops.pop();scene.remove(drop.drop);}}
updateModeIndicator(`물방울:${settings.dropCount}개`);}else{updateModeIndicator(`최소 물방울 개수:${settings.minDrops}개`);}
break;case'w':case'W':settings.waveIntensity=((settings.waveIntensity*10)%30+10)/10;updateModeIndicator(`물결 강도:x${settings.waveIntensity.toFixed(1)}`);break;case'f':case'F':const effectTypes=["normal","bubble","glitter","jelly"];const currentEffectIndex=effectTypes.indexOf(settings.dropEffectType);settings.dropEffectType=effectTypes[(currentEffectIndex+1)%effectTypes.length];initRaindrops();updateModeIndicator(`물방울 타입:${settings.dropEffectType}`);break;case't':case'T':settings.tornadoMode=!settings.tornadoMode;updateModeIndicator(settings.tornadoMode?'태풍 모드 활성화':'태풍 모드 비활성화');break;case'q':case'Q':settings.timeWarpMode=!settings.timeWarpMode;if(settings.timeWarpMode){settings.timeWarpFactor=settings.timeWarpFactor===1.0?0.2:(settings.timeWarpFactor===0.2?2.0:1.0);settings.twistIntensity=0.5;}else{settings.timeWarpFactor=1.0;settings.twistIntensity=0.0;}
updateModeIndicator(`시간 왜곡:x${settings.timeWarpFactor.toFixed(1)}`);break;case' ':settings.paused=!settings.paused;updateModeIndicator(settings.paused?'일시정지':'재생');break;case'p':case'P':settings.cameraMovement=!settings.cameraMovement;updateModeIndicator(settings.cameraMovement?'카메라 움직임 활성화':'카메라 고정 (사진 모드)');break;case'Escape':settings.overlayVisible=!settings.overlayVisible;document.querySelector('.overlay').style.display=settings.overlayVisible?'block':'none';break;}}
window.addEventListener('mousemove',onMouseMove);window.addEventListener('mousedown',onMouseDown);window.addEventListener('mouseup',onMouseUp);window.addEventListener('keydown',onKeyDown);window.addEventListener('touchmove',(event)=>{event.preventDefault();const touch=event.touches[0];const mouseEvent=new MouseEvent('mousemove',{clientX:touch.clientX,clientY:touch.clientY});onMouseMove(mouseEvent);},{passive:false});window.addEventListener('touchstart',(event)=>{event.preventDefault();const touch=event.touches[0];const mouseEvent=new MouseEvent('mousedown',{clientX:touch.clientX,clientY:touch.clientY});onMouseDown(mouseEvent);},{passive:false});window.addEventListener('touchend',()=>{onMouseUp();});window.addEventListener('resize',()=>{camera.aspect=window.innerWidth/window.innerHeight;camera.updateProjectionMatrix();renderer.setSize(window.innerWidth,window.innerHeight);});
</script>
</body>
</html>